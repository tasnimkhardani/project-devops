pipeline {
    agent any

    stages {
        // ... your existing stages (Clone, SonarQube, Docker, etc.) ...
        // (Keep them exactly as they are)
    }

    post {
        always {
            script {
                def buildStatus = currentBuild.result ?: 'SUCCESS'
                def message = "Pipeline Status: ${buildStatus}\nJob Name: ${env.JOB_NAME}\nBuild Number: ${env.BUILD_NUMBER}\nBuild URL: ${env.BUILD_URL}"

                // Slack notification
                if (buildStatus == 'SUCCESS') {
                    slackSend(channel: '#notif_app', message: "✅ Pipeline Succeeded\n${message}")
                } else {
                    slackSend(channel: '#notif_app', message: "❌ Pipeline Failed (${buildStatus})\n${message}")
                }

                // Email notification
                def subject = "Pipeline ${buildStatus}: ${env.JOB_NAME} #${env.BUILD_NUMBER}"
                def body = """
                    <html>
                    <body>
                        <h3>Pipeline ${buildStatus}</h3>
                        <p><b>Job:</b> ${env.JOB_NAME}</p>
                        <p><b>Build #:</b> ${env.BUILD_NUMBER}</p>
                        <p><b>Status:</b> ${buildStatus}</p>
                        <p><b>URL:</b> <a href='${env.BUILD_URL}'>View Build</a></p>
                    </body>
                    </html>
                """

                emailext(
                    to: 'aymanhjd@gmail.com',
                    from: 'aymanhjd@gmail.com',
                    subject: subject,
                    body: body,
                    mimeType: 'text/html'
                )
            }
        }
    }
}